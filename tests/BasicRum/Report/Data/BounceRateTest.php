<?php

namespace App\Tests\Report\Datak;

use App\BasicRum\Report\Data\BounceRate;
use PHPUnit\Framework\TestCase;

class BounceRateTest extends TestCase
{

    /**
     * Array
    (
    [2019-07-01 00:00:00] => Array
    (
    [bounced_buckets] => Array
    (
    [0] => 1
    [400] => 1
    [600] => 15
    [800] => 57
    [1000] => 56
    [1200] => 70
    [1400] => 61
    [1600] => 57
    [1800] => 39
    [2000] => 20
    [2200] => 18
    [2400] => 23
    [2600] => 17
    [2800] => 12
    [3000] => 14
    [3200] => 11
    [3400] => 6
    [3600] => 4
    [3800] => 4
    [4000] => 4
    [4200] => 1
    [4400] => 3
    [4600] => 2
    [4800] => 5
    [5000] => 1
    [5200] => 3
    [5400] => 1
    [5800] => 2
    [6000] => 5
    [6200] => 2
    [6400] => 2
    [6600] => 2
    [6800] => 7
    [7000] => 1
    [7800] => 1
    [8000] => 5
    [8400] => 1
    [8600] => 1
    [8800] => 2
    [10000] => 1
    [10400] => 1
    [11800] => 1
    [12000] => 1
    [12800] => 1
    )

    [all_buckets] => Array
    (
    [0] => 1
    [400] => 9
    [600] => 42
    [800] => 80
    [1000] => 86
    [1200] => 110
    [1400] => 94
    [1600] => 78
    [1800] => 59
    [2000] => 38
    [2200] => 26
    [2400] => 30
    [2600] => 23
    [2800] => 19
    [3000] => 19
    [3200] => 16
    [3400] => 9
    [3600] => 8
    [3800] => 6
    [4000] => 7
    [4200] => 3
    [4400] => 3
    [4600] => 3
    [4800] => 5
    [5000] => 2
    [5200] => 4
    [5400] => 2
    [5800] => 4
    [6000] => 8
    [6200] => 4
    [6400] => 3
    [6600] => 3
    [6800] => 7
    [7000] => 1
    [7800] => 1
    [8000] => 5
    [8200] => 1
    [8400] => 1
    [8600] => 1
    [8800] => 2
    [9800] => 1
    [10000] => 1
    [10400] => 2
    [10800] => 1
    [11800] => 1
    [12000] => 2
    [12800] => 1
    [13800] => 1
    [14600] => 1
    )

    )
     *
     */

    /**
     * @group visit_generate
     */
    public function testCalculateBounceRatePercentageInPeriod()
    {
        $bounceRate = new BounceRate();

        $data = [
            '2019-07-01 00:00:00' => [
                'bounced_buckets' => [
                    0   => 1,
                    200 => 4,
                    600 => 3
                ],
                'all_buckets' => [
                    0   => 1,
                    200 => 7,
                    600 => 3
                ]
            ],
            '2019-07-02 00:00:00' => [
                'bounced_buckets' => [
                    0   => 1,
                    200 => 4,
                    600 => 3
                ],
                'all_buckets' => [
                    0   => 1,
                    200 => 10,
                    600 => 8
                ]
            ]
        ];

        $this->assertEquals(
            [
                0   => '100',
                200 => '47',
                400 => '0',
                600 => '55',
            ],
            $bounceRate->generate($data)
        );
    }

}